name: T√§gliche Pool-Datenverarbeitung

# Workflow l√§uft einmal t√§glich
on:
  schedule:
    - cron: '0 2 * * *'  # T√§glich um 02:00 UTC
  workflow_dispatch:  # Erm√∂glicht manuelles Ausl√∂sen

jobs:
  process-pool-data:
    runs-on: ubuntu-latest

    steps:
      # Schritt 1: Repository auschecken
      - name: Repository auschecken
        uses: actions/checkout@v4

      # Schritt 2: Python-Umgebung einrichten
      - name: Python einrichten
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'  # Cache f√ºr schnellere Builds

      # Schritt 3: Abh√§ngigkeiten installieren
      - name: Abh√§ngigkeiten installieren
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # Schritt 4: TLM_Pools.py ausf√ºhren (Daten von API abrufen)
      - name: TLM_Pools.py ausf√ºhren
        run: python TLM_Pools.py

      # Schritt 5: avg_pools.py ausf√ºhren (Durchschnitte berechnen)
      - name: avg_pools.py ausf√ºhren
        run: python avg_pools.py

      # Schritt 6: avg_Visual.py ausf√ºhren (Visualisierungen erstellen)
      - name: avg_Visual.py ausf√ºhren
        run: python avg_Visual.py

      # Schritt 7: √Ñnderungen committen und pushen
      - name: √Ñnderungen committen und pushen
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add -A
          # Nur committen wenn es √Ñnderungen gibt
          git diff-index --quiet HEAD || git commit -m "ü§ñ Automatisches Update: Pool-Daten $(date +'%Y-%m-%d %H:%M:%S')"
          git push
